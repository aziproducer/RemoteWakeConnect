# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.2.0] - 2025-01-18

### Changed
- 🎨 **画面設定UIの大幅改善**
  - RDP標準の解像度スライダーUIを実装
  - ウィンドウ/フルスクリーンのラジオボタンを削除（スライダーに統合）
  - スライダーの最右端を「全画面表示」モードに変更
  
- 🖥️ **動的な解像度リスト生成**
  - プライマリモニターの最大解像度を自動検出
  - モニターより大きい解像度（4K等）を自動除外
  - 各PCの環境に合わせた適切な解像度のみ表示
  - プライマリモニターの現在の解像度を「(現在)」として表示

### Improved
- 📊 **エクスペリエンスタブとの統合**
  - 画面設定から重複する表示オプションを削除
  - 接続設定（パフォーマンス、自動再接続）を削除
  - エクスペリエンスタブで一元管理するように改善

### Fixed
- 🐛 **UI構造の修正**
  - XMLタグの不整合を修正
  - 削除したコントロールへの参照エラーを解消
  - null非許容フィールドの初期化警告を修正

### Technical Details
- 解像度リストにカスタムモードと全画面表示モードを追加
- ResolutionSliderイベントハンドラーの実装
- UpdateResolutionDisplay、InitializeResolutionSettingsメソッドの追加

---

## [1.1.1] - 2025-01-18

### Added
- 🔍 **接続履歴の機能改善**
  - 接続履歴選択時に自動でPing確認を実行
  - MACアドレス取得処理の強化（ARPテーブル→nbtstat の順で試行）
  - 接続後のMACアドレス自動補足（3秒後と5秒後の2回試行）
  - ユーザー名表示列の追加（DataGridに表示）

### Fixed
- 🐛 **MACアドレス取得の問題修正**
  - RDPファイル基準での接続時にMACアドレスが消える問題を修正
  - 履歴に既存のMACアドレスがある場合でも再取得されない問題を修正
  - LAN内機器のMACアドレスが正しく保存されない問題を修正

### Improved
- 📊 **UI/UX改善**
  - ウィンドウの初期幅を900pxから1000pxに拡張（見やすさ向上）
  - 接続履歴選択時にWOLインジケータが自動更新されるよう改善
  - デバッグログの出力を強化（MACアドレス取得プロセスの可視化）

### Technical Details
- `UpdateConnectionWithMacAddressAsync`メソッドの改良
- ConnectionHistoryServiceのUpdateConnectionメソッドにユーザー名パラメータ追加
- NetworkServiceのGetMacFromNbtstatAsyncメソッドの活用強化

---

## [1.1.0] - 2025-01-15

### Added
- 🔍 **セッション監視機能**
  - RDP接続前に自動でリモートマシンのセッション状態を確認
  - 他のユーザーが使用中の場合に警告ダイアログを表示
  - Windows Terminal Services (WTS) APIを使用した詳細なセッション情報取得
  - バックグラウンドでの定期的なセッション状態更新（5秒間隔）

- 🖥️ **OS種別判定機能**
  - Windows 10/11 Pro（単一セッション制限）を自動判定
  - Windows Server（RDS有り/無し）を自動判定
  - OS種別に応じた適切な警告レベルの設定

- ⚠️ **インテリジェント警告システム**
  - Windows 10/11 Pro: 強制切断リスクを警告
  - Windows Server（RDS無し）: 管理用セッション制限を警告
  - Windows Server（RDS有り）: 情報提供のみ（安全に接続可能）

- 📊 **セッション詳細表示**
  - ユーザー名、ドメイン、セッションタイプの表示
  - アクティブ/切断/アイドル等の状態表示
  - 詳細表示の展開/折りたたみ機能

### Improved
- ⚡ **パフォーマンス最適化**
  - WMI廃止、WTS APIのみを使用（2-5秒→即座に応答）
  - 段階的リトライ機能（5秒→10秒→20秒）
  - OS情報のYAMLキャッシュ（30日間有効）
  - サーバーハンドルの再利用（10分間キャッシュ）
  - カスタムポート対応の改善

- 🔧 **UI/UX改善**
  - モニター構成変更時の通知ダイアログ改善（OK ボタンのみ）
  - セッション確認をモニター設定ダイアログより先に実行
  - 接続時のモニター設定自動保存
  - null参照警告の完全解消

### Technical Implementation
- Windows Terminal Services API (wtsapi32.dll) P/Invoke実装
- WMI (Windows Management Instrumentation) を廃止（`[Obsolete]`マーク）
- YAMLによるOS情報の永続化
- 非同期処理による応答性の維持
- メモリリーク対策（サーバーハンドルの適切な管理）

---

## [1.0.1] - 2025-01-14

### Fixed
- 🔧 **履歴選択時のバグ修正**
  - RDPファイル読み込み時にComputerName、Port情報が失われる問題を修正
  - 履歴選択時に直接接続アドレス欄とポート欄が正しく設定されない問題を修正
  - 履歴データとRDPファイルの情報を適切にマージするよう改善

- 📝 **デバッグ機能の追加**
  - 履歴選択時のデバッグログをdebug.logファイルに出力
  - トラブルシューティングのための詳細情報記録

- 🛠️ **コード改善**
  - RDPファイル名生成ロジックの改善（タイムスタンプ除去、元のファイル名維持）
  - Path参照の曖昧性を解消（System.IO.Path明示指定）

---

## [1.0.0] - 2025-01-14

### Added
- 🚀 **Wake-on-LAN統合機能**
  - MACアドレスによるリモートマシンの起動
  - ARP、WMI、nbtstatを使用した自動MACアドレス検出
  - ブロードキャストアドレスの自動計算
  - Wake & Connect（起動→接続）のワンクリック実行

- 🖥️ **リモートデスクトップ接続**
  - RDPファイルのドラッグ&ドロップ読み込み
  - 直接接続機能（RDPファイル不要）
  - カスタムポート番号対応
  - DNS解決によるホスト名からIPアドレス変換

- 📺 **マルチモニター対応**
  - Windows APIを使用した物理モニター検出
  - 個別モニター選択機能
  - モニターレイアウトの視覚的表示
  - モニター設定の自動保存・復元
  - モニター構成変更の検出・警告システム

- 📋 **接続履歴管理**
  - YAML形式での軽量データ保存
  - 最大50件の履歴自動管理
  - リアルタイム検索・フィルタリング
  - ダブルクリックでの設定復元
  - IPアドレスとコンピュータ名の自動分離・整合性チェック

- ⚙️ **RDP詳細設定**
  - **エクスペリエンス設定タブ**
    - 接続タイプ選択（自動検出/LAN/ブロードバンド/モデム/カスタム）
    - 視覚効果の詳細設定（背景、フォントスムージング、コンポジション等）
    - パフォーマンス最適化オプション
  - **ローカルリソース設定タブ**
    - オーディオ再生先の選択
    - キーボードフック設定
    - デバイスリダイレクト（プリンター、クリップボード、ドライブ等）

- 🎯 **Windows統合機能**
  - Jump List統合（タスクバー右クリックメニュー）
  - 履歴からの直接接続・WOL実行
  - ステータスインジケーター表示
  - 接続状態確認（Ping機能）

- 🛡️ **セキュリティ・安定性**
  - データ整合性の自動チェック・修正
  - RDPファイル名の汚染防止
  - 適切なエラーハンドリング
  - メモリリーク対策

### Technical Features
- **.NET 8.0 WPF**アプリケーション
- **単一実行ファイル**対応（publish設定済み）
- **C# 12**言語機能活用
- **MVVM準拠**のクリーンアーキテクチャ
- **Windows API**との適切な統合
- **YamlDotNet**による軽量データ管理

### UI/UX Improvements
- **左右分割レイアウト**による直感的な操作
- モニター設定の下部中央配置
- タブによる設定画面の整理
- 列幅の最適化による情報表示効率化
- レスポンシブなウィンドウサイジング（850x900px）

### Performance Optimizations
- 非同期処理による UI応答性向上
- 効率的なモニター検出アルゴリズム
- メモリ使用量の最適化
- ファイルI/Oの最適化

### Developer Experience
- 包括的なエラーハンドリング
- 詳細なログ出力
- モジュラーなサービス設計
- 拡張性を考慮したアーキテクチャ

---

## バグ修正履歴

### v1.0.0での修正項目
- ✅ IPアドレス欄にコンピュータ名が混入する問題
- ✅ RDP履歴の汚染（毎回異なるファイル名生成）
- ✅ モニター検出が1つしか認識しない問題
- ✅ Assembly.Locationの警告（単一実行ファイル対応）
- ✅ 接続履歴の重複エントリ問題
- ✅ モニター構成変更時のクラッシュ
- ✅ ネットワーク断時の不適切なエラー表示

---

## 既知の制限事項

- Wake-on-LANは同一ネットワークセグメント内でのみ動作
- マルチモニター機能は最大32台まで対応
- 接続履歴は最大50件まで保存
- Windows 10/11のみサポート

---

## 貢献者

- **開発**: Claude Code (Anthropic) & User
- **テスト**: ユーザーコミュニティ
- **フィードバック**: GitHub Issues

---

*このプロジェクトは継続的に改善されています。機能要望やバグ報告は [GitHub Issues](https://github.com/aziproducer/RemoteWakeConnect/issues) までお寄せください。*