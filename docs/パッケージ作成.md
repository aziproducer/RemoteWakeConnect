# RemoteWakeConnect パッケージ作成・公開手順

## 概要

RemoteWakeConnectのリリースパッケージ作成とGitHub Releasesへの公開を自動化するPowerShellスクリプトの使用方法をまとめます。

## 必要な環境

### 必須ツール
- **PowerShell** (Windows標準)
- **.NET 8.0 SDK** (ビルド用)
- **GitHub CLI** (gh) - 公開用
  - インストール: https://cli.github.com/
  - 認証: `gh auth login`

## スクリプトファイル

### 1. create-release.ps1
**目的**: リリースパッケージの作成  
**場所**: プロジェクトルート  

### 2. publish-github-release.ps1
**目的**: GitHub Releasesへの公開  
**場所**: プロジェクトルート  

## 使用手順

### Step 1: リリースパッケージ作成

```powershell
# 基本的な使用方法
.\create-release.ps1

# バージョン指定
.\create-release.ps1 -Version "1.2.1"
```

**実行内容:**
1. .NET プロジェクトをReleaseビルド
2. 単一実行ファイル(.exe)を生成
3. 不要ファイルを除外してパッケージング
4. `releases\RemoteWakeConnect-v{Version}.zip` を作成

**除外されるファイル:**
- `rdp_files\*` (フォルダ内のファイルのみ、フォルダ自体は空で作成)
- `debug.log`
- `*.pdb`
- `*.log`
- `connection_history.yaml`

**出力例:**
```
releases/
└── RemoteWakeConnect-v1.2.1.zip
    ├── RemoteWakeConnect.exe    # メイン実行ファイル
    ├── rdp_files/               # 空フォルダ
    └── README.txt               # 使用方法説明
```

### Step 2: GitHub Releasesに公開

```powershell
# 基本的な使用方法（Step1と同じバージョンで）
.\publish-github-release.ps1

# バージョン指定
.\publish-github-release.ps1 -Version "1.2.1"

# ドラフトとして公開（後で手動で正式公開）
.\publish-github-release.ps1 -Version "1.2.1" -Draft
```

**実行内容:**
1. ZIPファイルの存在確認
2. GitHub CLI認証状態確認
3. 既存リリースの重複チェック
4. リリースノート自動生成
5. GitHub Releasesに公開

**リリースノート自動生成内容:**
- バージョン情報
- 主な変更点（テンプレート）
- インストール方法
- 動作環境
- リンク集

## 完全なリリース作業フロー

### 1. バージョン更新
```powershell
# 1. プロジェクトファイルのバージョン更新
# src/RemoteWakeConnect.csproj の AssemblyVersion, FileVersion, ProductVersion

# 2. CHANGELOG.md に新バージョンの変更内容を追加

# 3. docs/要件定義.md の更新履歴を更新
```

### 2. パッケージ作成と公開
```powershell
# Step 1: パッケージ作成
.\create-release.ps1 -Version "1.2.1"

# Step 2: GitHub公開
.\publish-github-release.ps1 -Version "1.2.1"
```

### 3. 公開後の確認
- GitHub Releases: https://github.com/aziproducer/RemoteWakeConnect/releases
- ダウンロードテスト
- 実行テスト

## トラブルシューティング

### よくあるエラーと対策

#### 1. Build failed!
```
原因: .NET SDKがインストールされていない、またはプロジェクトファイルにエラー
対策: dotnet --version でSDK確認、エラーメッセージを確認
```

#### 2. GitHub CLI is not installed
```
原因: GitHub CLIがインストールされていない
対策: https://cli.github.com/ からインストール
```

#### 3. Not authenticated with GitHub
```
原因: GitHub CLIで認証していない
対策: gh auth login を実行
```

#### 4. Release already exists
```
原因: 同じバージョンのリリースが既に存在
対策: スクリプトが自動で削除・再作成を提案
```

## ファイル構成詳細

### パッケージ内容 (ZIP内部)
```
RemoteWakeConnect-v1.2.1.zip
├── RemoteWakeConnect.exe      # メイン実行ファイル (単一EXE)
├── rdp_files/                 # RDPファイル保存用 (空フォルダ)
└── README.txt                 # インストール・使用方法
```

### 除外ルール
| ファイル/フォルダ | 理由 |
|------------------|------|
| `rdp_files\*.rdp` | ユーザー固有のRDPファイル |
| `debug.log` | デバッグ用ログ |
| `*.pdb` | デバッグシンボル |
| `connection_history.yaml` | ユーザー固有の履歴 |

## カスタマイズ

### リリースノートのカスタマイズ
`publish-github-release.ps1` の `$releaseNotes` 変数を編集して、リリースノートの内容をカスタマイズできます。

### 除外ファイルの変更
`create-release.ps1` の `$excludePatterns` 配列を編集して、パッケージから除外するファイルを変更できます。

## 参考リンク

- [GitHub CLI Documentation](https://cli.github.com/manual/)
- [.NET Single File Deployment](https://docs.microsoft.com/en-us/dotnet/core/deploying/single-file)
- [PowerShell Documentation](https://docs.microsoft.com/en-us/powershell/)

## 更新履歴

- 2025-08-19: 初版作成
- パッケージ作成・公開スクリプトの使用方法を網羅的にまとめ